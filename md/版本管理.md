# Behavior3 Editor ç‰ˆæœ¬ç®¡ç†è¯¦è§£

## ğŸ“‹ æ¦‚è¿°

Behavior3 Editor ä½¿ç”¨**è¯­ä¹‰åŒ–ç‰ˆæœ¬å·**ç®¡ç†ç¼–è¾‘å™¨å’Œæ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œç¡®ä¿ï¼š
- æ–‡ä»¶æ ¼å¼çš„æ¼”è¿›å’Œå…¼å®¹æ€§
- å›¢é˜Ÿåä½œæ—¶ç‰ˆæœ¬ä¸€è‡´æ€§
- ç”¨æˆ·åŠæ—¶å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬

---

## ğŸ”¢ ç‰ˆæœ¬å·çš„ä½ç½®

### 1. ç¼–è¾‘å™¨ç‰ˆæœ¬ï¼ˆä¸¤å¤„ï¼‰

#### 1.1 package.json
```json
{
  "name": "behavior3editor",
  "version": "1.8.5",  â† åº”ç”¨ç‰ˆæœ¬ï¼ˆnpm æ ‡å‡†ï¼‰
  "description": "è¡Œä¸ºæ ‘ç¼–è¾‘å™¨"
}
```

**ä½œç”¨ï¼š**
- npm åŒ…ç®¡ç†çš„ç‰ˆæœ¬å·
- åº”ç”¨å®‰è£…åŒ…çš„ç‰ˆæœ¬å·
- è‡ªåŠ¨æ›´æ–°æ—¶çš„ç‰ˆæœ¬æ¯”å¯¹

#### 1.2 src/misc/b3type.ts
```typescript
/**
 * ç¼–è¾‘å™¨ç‰ˆæœ¬å·
 * 
 * ç”¨é€”ï¼š
 * - æ˜¾ç¤ºåœ¨æ ‡é¢˜æ å’Œå…³äºç•Œé¢
 * - æ£€æµ‹è¡Œä¸ºæ ‘æ–‡ä»¶çš„å…¼å®¹æ€§
 * - è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬æ¯”å¯¹
 */
export const VERSION = "1.8.5";
```

**ä½œç”¨ï¼š**
- è¿è¡Œæ—¶ä½¿ç”¨çš„ç‰ˆæœ¬å¸¸é‡
- ä¸æ–‡ä»¶ç‰ˆæœ¬æ¯”å¯¹
- åˆ›å»ºæ–°æ–‡ä»¶æ—¶çš„é»˜è®¤ç‰ˆæœ¬

### 2. æ–‡ä»¶ç‰ˆæœ¬ï¼ˆæ¯ä¸ª JSON æ–‡ä»¶ï¼‰

#### è¡Œä¸ºæ ‘æ–‡ä»¶
```json
// sample/workdir/hero.json
{
  "version": "1.8.0",  â† æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬
  "name": "hero",
  "desc": "è‹±é›„æµ‹è¯•AI",
  ...
}
```

**ä½œç”¨ï¼š**
- æ ‡è¯†æ­¤æ–‡ä»¶ç”±å“ªä¸ªç‰ˆæœ¬çš„ç¼–è¾‘å™¨åˆ›å»º
- ç”¨äºå…¼å®¹æ€§æ£€æŸ¥
- è®°å½•æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬

---

## ğŸ” ç‰ˆæœ¬çš„ä½œç”¨

### 1. å…¼å®¹æ€§æ£€æŸ¥

#### 1.1 ç‰ˆæœ¬æ¯”è¾ƒå‡½æ•°

**ä»£ç ä½ç½®ï¼š** `src/misc/b3util.ts:134-142`

```typescript
export const isNewVersion = (version: string) => {
  // è§£ææ–‡ä»¶ç‰ˆæœ¬å·ï¼šå¦‚ "1.8.5" â†’ [1, 8, 5]
  const [major, minor, patch] = version.split(".").map(Number);
  
  // è§£æç¼–è¾‘å™¨ç‰ˆæœ¬å·
  const [major2, minor2, patch2] = VERSION.split(".").map(Number);
  
  // æ¯”è¾ƒç‰ˆæœ¬ï¼šæ–‡ä»¶ç‰ˆæœ¬ > ç¼–è¾‘å™¨ç‰ˆæœ¬ ?
  return (
    major > major2 ||                           // ä¸»ç‰ˆæœ¬æ›´æ–°
    (major === major2 && minor > minor2) ||     // æ¬¡ç‰ˆæœ¬æ›´æ–°
    (major === major2 && minor === minor2 && patch > patch2)  // è¡¥ä¸æ›´æ–°
  );
};
```

**æ¯”è¾ƒç¤ºä¾‹ï¼š**

| æ–‡ä»¶ç‰ˆæœ¬ | ç¼–è¾‘å™¨ç‰ˆæœ¬ | isNewVersion ç»“æœ | è¯´æ˜ |
|---------|-----------|------------------|------|
| 1.9.0 | 1.8.5 | âœ… true | æ–‡ä»¶å¤ªæ–°ï¼Œè­¦å‘Š |
| 1.8.6 | 1.8.5 | âœ… true | æ–‡ä»¶å¤ªæ–°ï¼Œè­¦å‘Š |
| 1.8.5 | 1.8.5 | âŒ false | ç‰ˆæœ¬ç›¸åŒï¼Œæ­£å¸¸ |
| 1.8.4 | 1.8.5 | âŒ false | æ–‡ä»¶è¾ƒæ—§ï¼Œæ­£å¸¸ |
| 1.7.0 | 1.8.5 | âŒ false | æ–‡ä»¶è¾ƒæ—§ï¼Œæ­£å¸¸ |

#### 1.2 æ‰“å¼€æ–‡ä»¶æ—¶æ£€æŸ¥

**ä»£ç ä½ç½®ï¼š** `src/contexts/workspace-context.ts:914-916`

```typescript
open: (path, focusId) => {
  // ... åˆ›å»º EditorStore
  
  // ç‰ˆæœ¬æ£€æŸ¥
  if (b3util.isNewVersion(editor.data.version)) {
    message.warning(
      i18n.t("alertNewVersion", { version: editor.data.version })
    );
  }
}
```

**æ•ˆæœï¼š**
```
æ‰“å¼€ hero.json (version: "1.9.0")
  â†“
å½“å‰ç¼–è¾‘å™¨ç‰ˆæœ¬ï¼š1.8.5
  â†“
isNewVersion("1.9.0") â†’ true
  â†“
æ˜¾ç¤ºè­¦å‘Šå¼¹çª—ï¼š
  "æ­¤æ–‡ä»¶ç”±æ–°ç‰ˆæœ¬ Behavior3(1.9.0) åˆ›å»ºï¼Œè¯·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"
  â†“
æ–‡ä»¶ä»ç„¶å¯ä»¥æ‰“å¼€ï¼ˆä½†å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ï¼‰
```

**è­¦å‘Šæ–‡æœ¬ï¼š**
```json
// public/locales/zh.json
"alertNewVersion": "æ­¤æ–‡ä»¶ç”±æ–°ç‰ˆæœ¬ Behavior3({{version}}) åˆ›å»ºï¼Œè¯·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"

// public/locales/en.json
"alertNewVersion": "This file is created by a newer version of Behavior3({{version}}), please upgrade to the latest version."
```

### 2. åˆ›å»ºæ–‡ä»¶æ—¶æ ‡è®°ç‰ˆæœ¬

#### 2.1 æ–°å»ºæ–‡ä»¶

**ä»£ç ä½ç½®ï¼š** `src/misc/b3util.ts:918-920`

```typescript
export const createNewTree = (path: string) => {
  const tree: TreeData = {
    version: VERSION,  // â† ä½¿ç”¨å½“å‰ç¼–è¾‘å™¨ç‰ˆæœ¬
    name: Path.basenameWithoutExt(path),
    prefix: "",
    group: [],
    import: [],
    vars: [],
    root: {
      id: "1",
      name: "Sequence",
      children: [],
    },
  };
  return tree;
}
```

**æµç¨‹ï¼š**
```
ç”¨æˆ·æ–°å»ºæ–‡ä»¶ test.json
  â†“
è°ƒç”¨ createNewTree("test.json")
  â†“
åˆ›å»º TreeData {
  version: "1.8.5",  â† è‡ªåŠ¨ä½¿ç”¨å½“å‰ç¼–è¾‘å™¨ç‰ˆæœ¬
  name: "test",
  ...
}
  â†“
ä¿å­˜ä¸º test.json
```

#### 2.2 ä¿å­˜æ–‡ä»¶æ—¶ä¿ç•™ç‰ˆæœ¬

```
ç¼–è¾‘æ–‡ä»¶ï¼ˆä¿®æ”¹èŠ‚ç‚¹ã€å‚æ•°ç­‰ï¼‰
  â†“
graph.save()
  â†“
æ”¶é›† TreeData {
  version: "1.8.5",  â† ä¿ç•™åŸæœ‰ç‰ˆæœ¬ï¼ˆä¸ä¿®æ”¹ï¼‰
  ...
}
  â†“
å†™å…¥ JSON æ–‡ä»¶
```

**æ³¨æ„ï¼š**
- ç¼–è¾‘æ–‡ä»¶æ—¶ï¼Œä¸ä¼šæ›´æ–°æ–‡ä»¶çš„ version å­—æ®µ
- ç‰ˆæœ¬å·åªåœ¨åˆ›å»ºæ–‡ä»¶æ—¶è®¾ç½®
- è¿™æ ·å¯ä»¥è¿½è¸ªæ–‡ä»¶çš„åˆ›å»ºç‰ˆæœ¬

---

## ğŸ¯ è¯­ä¹‰åŒ–ç‰ˆæœ¬å·è¯¦è§£

### 1. æ ¼å¼

```
major.minor.patch
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€ è¡¥ä¸ç‰ˆæœ¬ï¼ˆbugä¿®å¤ï¼‰
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€ æ¬¡ç‰ˆæœ¬ï¼ˆæ–°åŠŸèƒ½ï¼Œå‘å‰å…¼å®¹ï¼‰
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸»ç‰ˆæœ¬ï¼ˆé‡å¤§æ›´æ–°ï¼Œå¯èƒ½ä¸å…¼å®¹ï¼‰
```

### 2. ç‰ˆæœ¬å·é€’å¢è§„åˆ™

| å˜æ›´ç±»å‹ | ç‰ˆæœ¬é€’å¢ | ç¤ºä¾‹ |
|---------|---------|------|
| ä¿®å¤ bugï¼Œæ— æ–°åŠŸèƒ½ | patch + 1 | 1.8.5 â†’ 1.8.6 |
| æ·»åŠ æ–°åŠŸèƒ½ï¼Œå‘å‰å…¼å®¹ | minor + 1, patch = 0 | 1.8.5 â†’ 1.9.0 |
| é‡å¤§æ›´æ–°ï¼Œä¸å…¼å®¹æ—§ç‰ˆ | major + 1, minor = 0, patch = 0 | 1.8.5 â†’ 2.0.0 |

### 3. ç‰ˆæœ¬æ¯”è¾ƒé€»è¾‘

#### æ¯”è¾ƒç®—æ³•
```typescript
function compareVersions(v1, v2) {
  const [ma1, mi1, pa1] = v1.split(".").map(Number);
  const [ma2, mi2, pa2] = v2.split(".").map(Number);
  
  // 1. å…ˆæ¯”è¾ƒä¸»ç‰ˆæœ¬
  if (ma1 !== ma2) return ma1 - ma2;
  
  // 2. ä¸»ç‰ˆæœ¬ç›¸åŒï¼Œæ¯”è¾ƒæ¬¡ç‰ˆæœ¬
  if (mi1 !== mi2) return mi1 - mi2;
  
  // 3. æ¬¡ç‰ˆæœ¬ä¹Ÿç›¸åŒï¼Œæ¯”è¾ƒè¡¥ä¸ç‰ˆæœ¬
  return pa1 - pa2;
}
```

#### æ¯”è¾ƒç¤ºä¾‹

```typescript
// ç¤ºä¾‹1ï¼šä¸»ç‰ˆæœ¬ä¸åŒ
compareVersions("2.0.0", "1.8.5")
â†’ major: 2 vs 1 â†’ 2 > 1 âœ“
â†’ 2.0.0 æ›´æ–°

// ç¤ºä¾‹2ï¼šæ¬¡ç‰ˆæœ¬ä¸åŒ
compareVersions("1.9.0", "1.8.5")
â†’ major: 1 vs 1 â†’ ç›¸ç­‰
â†’ minor: 9 vs 8 â†’ 9 > 8 âœ“
â†’ 1.9.0 æ›´æ–°

// ç¤ºä¾‹3ï¼šè¡¥ä¸ç‰ˆæœ¬ä¸åŒ
compareVersions("1.8.6", "1.8.5")
â†’ major: 1 vs 1 â†’ ç›¸ç­‰
â†’ minor: 8 vs 8 â†’ ç›¸ç­‰
â†’ patch: 6 vs 5 â†’ 6 > 5 âœ“
â†’ 1.8.6 æ›´æ–°

// ç¤ºä¾‹4ï¼šç‰ˆæœ¬ç›¸åŒ
compareVersions("1.8.5", "1.8.5")
â†’ å®Œå…¨ç›¸ç­‰
â†’ æ— éœ€æ›´æ–°

// ç¤ºä¾‹5ï¼šæ–‡ä»¶è¾ƒæ—§
compareVersions("1.7.0", "1.8.5")
â†’ minor: 7 vs 8 â†’ 7 < 8
â†’ æ–‡ä»¶è¾ƒæ—§ï¼Œæ— éœ€è­¦å‘Š
```

---

## ğŸ”„ ç‰ˆæœ¬æ¼”è¿›ç¤ºä¾‹

### å‡è®¾çš„ç‰ˆæœ¬å†å²

```
v1.0.0 (2020-01)
  - åˆå§‹ç‰ˆæœ¬
  - åŸºæœ¬çš„è¡Œä¸ºæ ‘ç¼–è¾‘åŠŸèƒ½
  - TreeData æ ¼å¼ï¼š{ name, root }

v1.5.0 (2021-06)
  - æ·»åŠ å˜é‡å£°æ˜åŠŸèƒ½
  - TreeData æ–°å¢å­—æ®µï¼švars
  - å‘å‰å…¼å®¹ï¼šæ—§æ–‡ä»¶ä»å¯æ‰“å¼€ï¼ˆvars é»˜è®¤ä¸ºç©ºæ•°ç»„ï¼‰

v1.8.0 (2023-03)
  - æ·»åŠ å­æ ‘å¼•ç”¨åŠŸèƒ½
  - NodeData æ–°å¢å­—æ®µï¼špath
  - TreeData æ–°å¢å­—æ®µï¼šimport
  - å‘å‰å…¼å®¹ï¼šæ—§æ–‡ä»¶ä»å¯æ‰“å¼€

v1.8.5 (2024-10)  â† å½“å‰ç‰ˆæœ¬
  - Bug ä¿®å¤å’Œæ€§èƒ½ä¼˜åŒ–
  - æ ¼å¼æ— å˜åŒ–
  - å®Œå…¨å…¼å®¹ 1.8.x çš„æ–‡ä»¶

v1.9.0 (æœªæ¥)
  - è®¡åˆ’æ·»åŠ ç±»å‹ç³»ç»Ÿ
  - VarDecl æ–°å¢å­—æ®µï¼štype
  - å‘å‰å…¼å®¹ï¼šæ—§æ–‡ä»¶ä»å¯æ‰“å¼€
```

### å…¼å®¹æ€§çŸ©é˜µ

| æ–‡ä»¶ç‰ˆæœ¬ | 1.7.0ç¼–è¾‘å™¨ | 1.8.0ç¼–è¾‘å™¨ | 1.8.5ç¼–è¾‘å™¨ | 1.9.0ç¼–è¾‘å™¨ |
|---------|-----------|-----------|-----------|-----------|
| **1.7.0** | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| **1.8.0** | âš ï¸ è­¦å‘Š | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| **1.8.5** | âš ï¸ è­¦å‘Š | âš ï¸ è­¦å‘Š | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| **1.9.0** | âš ï¸ è­¦å‘Š | âš ï¸ è­¦å‘Š | âš ï¸ è­¦å‘Š | âœ… æ­£å¸¸ |

---

## ğŸ“ å›¢é˜Ÿåä½œåœºæ™¯

### åœºæ™¯1ï¼šç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜

**é—®é¢˜ï¼š**
```
å¼ ä¸‰ï¼ˆç¼–è¾‘å™¨ 1.8.5ï¼‰åˆ›å»º hero.json
  â†“
hero.json { version: "1.8.5" }
  â†“
æäº¤åˆ° Git
  â†“
æå››ï¼ˆç¼–è¾‘å™¨ 1.7.0ï¼‰æ‰“å¼€ hero.json
  â†“
è­¦å‘Šï¼š"æ­¤æ–‡ä»¶ç”±æ–°ç‰ˆæœ¬ 1.8.5 åˆ›å»º"
  â†“
æå››ç¼–è¾‘å¹¶ä¿å­˜
  â†“
å¯èƒ½ä¸¢å¤± 1.8.0+ çš„æ–°åŠŸèƒ½ï¼ˆå¦‚å­æ ‘å¼•ç”¨ï¼‰
  â†“
æ•°æ®æŸåæˆ–åŠŸèƒ½å¼‚å¸¸
```

**è§£å†³æ–¹æ¡ˆï¼š**
```
å›¢é˜Ÿç»Ÿä¸€ä½¿ç”¨åŒä¸€ç‰ˆæœ¬çš„ç¼–è¾‘å™¨
  â†“
æ‰€æœ‰æ–‡ä»¶ç‰ˆæœ¬ä¸€è‡´
  â†“
é¿å…å…¼å®¹æ€§é—®é¢˜
```

### åœºæ™¯2ï¼šç‰ˆæœ¬å‡çº§

**æµç¨‹ï¼š**
```
é¡¹ç›®ä½¿ç”¨ 1.7.0 ç¼–è¾‘å™¨
  â†“
æ‰€æœ‰æ–‡ä»¶ version: "1.7.0"
  â†“
å›¢é˜Ÿå†³å®šå‡çº§åˆ° 1.8.5
  â†“
1. æ‰€æœ‰æˆå‘˜å®‰è£… 1.8.5 ç¼–è¾‘å™¨
2. æ‰“å¼€æ–‡ä»¶ï¼Œç¼–è¾‘å™¨è‡ªåŠ¨å…¼å®¹æ—§ç‰ˆæœ¬æ–‡ä»¶
3. ç¼–è¾‘å¹¶ä¿å­˜åï¼Œversion ä»ä¸º "1.7.0"ï¼ˆä¸è‡ªåŠ¨æ›´æ–°ï¼‰
4. å¦‚éœ€ç»Ÿä¸€ç‰ˆæœ¬å·ï¼š
   - æ‰‹åŠ¨ä¿®æ”¹ JSON æ–‡ä»¶çš„ version å­—æ®µ
   - æˆ–ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ç»Ÿä¸€æ›´æ–°
```

### åœºæ™¯3ï¼šæ–‡ä»¶æ ¼å¼è¿ç§»

**å½“æ–°ç‰ˆæœ¬æ”¹å˜æ•°æ®æ ¼å¼æ—¶ï¼š**

```
// å‡è®¾ 1.9.0 æ·»åŠ äº†æ–°çš„å¿…éœ€å­—æ®µ

// æ—§æ–‡ä»¶ï¼ˆ1.8.0ï¼‰
{
  "version": "1.8.0",
  "name": "hero",
  "root": { ... }
}

// 1.9.0 ç¼–è¾‘å™¨æ‰“å¼€æ—§æ–‡ä»¶æ—¶
open(path) {
  const tree = readTree(path);
  
  // æ£€æµ‹ç‰ˆæœ¬
  if (tree.version < "1.9.0") {
    // æ‰§è¡Œè¿ç§»é€»è¾‘
    tree = migrateFrom18To19(tree);
    tree.version = "1.9.0";
  }
  
  return tree;
}

// è¿ç§»å‡½æ•°
function migrateFrom18To19(tree) {
  // æ·»åŠ æ–°å­—æ®µçš„é»˜è®¤å€¼
  tree.newField = defaultValue;
  return tree;
}
```

---

## ğŸ”§ ç‰ˆæœ¬ç®¡ç†æ“ä½œ

### 1. æ›´æ–°ç¼–è¾‘å™¨ç‰ˆæœ¬

#### 1.1 ä½¿ç”¨ npm version å‘½ä»¤

```bash
# è¡¥ä¸ç‰ˆæœ¬æ›´æ–°ï¼ˆbugä¿®å¤ï¼‰
npm version patch
# 1.8.5 â†’ 1.8.6

# æ¬¡ç‰ˆæœ¬æ›´æ–°ï¼ˆæ–°åŠŸèƒ½ï¼‰
npm version minor
# 1.8.5 â†’ 1.9.0

# ä¸»ç‰ˆæœ¬æ›´æ–°ï¼ˆé‡å¤§æ›´æ–°ï¼‰
npm version major
# 1.8.5 â†’ 2.0.0
```

**æ•ˆæœï¼š**
- è‡ªåŠ¨æ›´æ–° `package.json` çš„ version
- è‡ªåŠ¨åˆ›å»º git commit å’Œ tag

#### 1.2 æ‰‹åŠ¨åŒæ­¥ VERSION å¸¸é‡

```typescript
// 1. ä¿®æ”¹ package.json
{
  "version": "1.8.6"  // 1.8.5 â†’ 1.8.6
}

// 2. åŒæ­¥ä¿®æ”¹ src/misc/b3type.ts
export const VERSION = "1.8.6";  // 1.8.5 â†’ 1.8.6
```

**æ³¨æ„ï¼š**
- npm version å‘½ä»¤ä¸ä¼šè‡ªåŠ¨æ›´æ–° VERSION å¸¸é‡
- éœ€è¦æ‰‹åŠ¨ä¿æŒä¸¤å¤„ä¸€è‡´
- å¦åˆ™ç‰ˆæœ¬æ£€æŸ¥ä¼šå‡ºé”™

### 2. æ‰¹é‡æ›´æ–°æ–‡ä»¶ç‰ˆæœ¬

**åœºæ™¯ï¼š** å‡çº§ç¼–è¾‘å™¨åï¼Œæƒ³ç»Ÿä¸€æ‰€æœ‰æ–‡ä»¶çš„ç‰ˆæœ¬å·

#### æ–¹æ³•1ï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬

```javascript
// scripts/update-version.js
const fs = require('fs');
const glob = require('glob');

const NEW_VERSION = "1.8.5";

// æŸ¥æ‰¾æ‰€æœ‰è¡Œä¸ºæ ‘æ–‡ä»¶
glob("workdir/**/*.json", (err, files) => {
  files.forEach(file => {
    const tree = JSON.parse(fs.readFileSync(file, 'utf8'));
    
    // æ›´æ–°ç‰ˆæœ¬å·
    tree.version = NEW_VERSION;
    
    // å†™å›æ–‡ä»¶
    fs.writeFileSync(file, JSON.stringify(tree, null, 2));
    
    console.log(`Updated: ${file}`);
  });
});
```

**è¿è¡Œï¼š**
```bash
node scripts/update-version.js
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ›´æ–°

```bash
# 1. å…¨å±€æœç´¢æ›¿æ¢
# VS Code: Ctrl+Shift+H
# æŸ¥æ‰¾ï¼š   "version": "1.8.0"
# æ›¿æ¢ä¸ºï¼š "version": "1.8.5"

# 2. ä»”ç»†æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶ï¼Œé¿å…è¯¯æ”¹å…¶ä»–å­—æ®µ
```

### 3. å‘å¸ƒæ–°ç‰ˆæœ¬æµç¨‹

```bash
# 1. ç¡®ä¿ä»£ç å·²æäº¤
git status

# 2. æ›´æ–°ç‰ˆæœ¬å·
npm version minor  # æˆ– patchã€major

# 3. æ‰‹åŠ¨åŒæ­¥ VERSION å¸¸é‡
# ç¼–è¾‘ src/misc/b3type.ts

# 4. æäº¤ç‰ˆæœ¬æ›´æ–°
git add src/misc/b3type.ts
git commit --amend --no-edit

# 5. æ„å»ºåº”ç”¨
npm run build

# 6. æ‰“åŒ…å‘å¸ƒ
npm run dist

# 7. æ¨é€åˆ°è¿œç¨‹
git push origin master --tags
```

---

## ğŸ“Š ç‰ˆæœ¬å·çš„è®¾è®¡åŸåˆ™

### 1. å‘å‰å…¼å®¹ï¼ˆå¿…é¡»ï¼‰

**åŸåˆ™ï¼š**
- æ–°ç¼–è¾‘å™¨å¿…é¡»èƒ½æ‰“å¼€æ—§æ–‡ä»¶
- æ·»åŠ æ–°å­—æ®µæ—¶æä¾›é»˜è®¤å€¼
- ä¸åˆ é™¤æˆ–é‡å‘½åå·²æœ‰å­—æ®µ

**ç¤ºä¾‹ï¼š**
```typescript
// 1.8.0 æ·»åŠ  import å­—æ®µ
interface TreeData {
  // ... åŸæœ‰å­—æ®µ
  import: string[];  // æ–°å­—æ®µ
}

// è¯»å– 1.7.0 æ–‡ä»¶æ—¶
const tree = readTree(path);
tree.import = tree.import || [];  // æä¾›é»˜è®¤å€¼
```

### 2. å‘åè­¦å‘Šï¼ˆå»ºè®®ï¼‰

**åŸåˆ™ï¼š**
- æ—§ç¼–è¾‘å™¨æ‰“å¼€æ–°æ–‡ä»¶æ—¶è­¦å‘Š
- é¿å…æ•°æ®ä¸¢å¤±æˆ–åŠŸèƒ½å¼‚å¸¸
- æç¤ºç”¨æˆ·å‡çº§

**å®ç°ï¼š**
```typescript
if (isNewVersion(tree.version)) {
  warning("è¯·å‡çº§ç¼–è¾‘å™¨");
}
```

### 3. ç‰ˆæœ¬å·è¯­ä¹‰åŒ–ï¼ˆè§„èŒƒï¼‰

**è§„èŒƒï¼š**
- **ä¸»ç‰ˆæœ¬ï¼ˆmajorï¼‰**ï¼šä¸å…¼å®¹çš„ API æ”¹åŠ¨
- **æ¬¡ç‰ˆæœ¬ï¼ˆminorï¼‰**ï¼šå‘å‰å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **è¡¥ä¸ç‰ˆæœ¬ï¼ˆpatchï¼‰**ï¼šå‘å‰å…¼å®¹çš„é—®é¢˜ä¿®æ­£

**æœ¬é¡¹ç›®ç¤ºä¾‹ï¼š**
```
1.0.0 â†’ 1.5.0  æ·»åŠ å˜é‡åŠŸèƒ½ï¼ˆminorï¼‰
1.5.0 â†’ 1.5.1  ä¿®å¤å˜é‡ bugï¼ˆpatchï¼‰
1.5.1 â†’ 1.8.0  æ·»åŠ å­æ ‘åŠŸèƒ½ï¼ˆminorï¼‰
1.8.0 â†’ 1.8.5  ä¼˜åŒ–å’Œ bug ä¿®å¤ï¼ˆpatchï¼‰
1.8.5 â†’ 2.0.0  é‡å†™æ ¸å¿ƒæ¶æ„ï¼ˆmajorï¼‰
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¼€å‘æ—¶

**è§„åˆ™ï¼š**
- âœ… ä¿æŒ `package.json` å’Œ `VERSION` å¸¸é‡ä¸€è‡´
- âœ… å¼€å‘æœŸé—´ä½¿ç”¨åŒä¸€ç‰ˆæœ¬å·
- âœ… æäº¤ä»£ç å‰æ£€æŸ¥ç‰ˆæœ¬å·
- âœ… é‡å¤§æ›´æ–°æ—¶æ›´æ–°ä¸»ç‰ˆæœ¬å·

**æ£€æŸ¥å‘½ä»¤ï¼š**
```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
npm version

# æˆ–ç›´æ¥æŸ¥çœ‹æ–‡ä»¶
cat package.json | grep version
```

### 2. å›¢é˜Ÿåä½œæ—¶

**è§„åˆ™ï¼š**
- âœ… ç»Ÿä¸€ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ç¼–è¾‘å™¨
- âœ… å‡çº§æ—¶å›¢é˜ŸåŒæ­¥æ›´æ–°
- âœ… åœ¨æ–‡æ¡£ä¸­è¯´æ˜å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬
- âœ… å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬

**å»ºè®®é…ç½®ï¼ˆREADME.mdï¼‰ï¼š**
```markdown
## å¼€å‘ç¯å¢ƒ

- Behavior3 Editor: v1.8.5
- Node.js: v18+
- npm: v9+

è¯·ç¡®ä¿ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ç¼–è¾‘å™¨ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜ã€‚
```

### 3. æ–‡ä»¶ç®¡ç†æ—¶

**è§„åˆ™ï¼š**
- âœ… ä¸è¦æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„ version å­—æ®µ
- âœ… è®©ç¼–è¾‘å™¨è‡ªåŠ¨ç®¡ç†ç‰ˆæœ¬
- âœ… Git æäº¤æ—¶åŒ…å«ç‰ˆæœ¬ä¿¡æ¯

**Git æäº¤ç¤ºä¾‹ï¼š**
```bash
git commit -m "feat: æ·»åŠ è‹±é›„AIè¡Œä¸ºæ ‘ (v1.8.5)"
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªç‰ˆæœ¬å·ï¼ˆpackage.json å’Œ VERSION å¸¸é‡ï¼‰ï¼Ÿ

**A**: èŒè´£ä¸åŒï¼š

```
package.json:
  - npm åŒ…ç®¡ç†çš„ç‰ˆæœ¬
  - åº”ç”¨å®‰è£…åŒ…çš„ç‰ˆæœ¬
  - è‡ªåŠ¨æ›´æ–°æ£€æŸ¥

VERSION å¸¸é‡:
  - è¿è¡Œæ—¶ä»£ç ä½¿ç”¨
  - æ–‡ä»¶ç‰ˆæœ¬æ¯”å¯¹
  - åˆ›å»ºæ–‡ä»¶æ—¶çš„ç‰ˆæœ¬æ ‡è®°
```

**å¿…é¡»ä¿æŒä¸€è‡´ï¼**

### Q2: æ‰“å¼€æ—§ç‰ˆæœ¬æ–‡ä»¶ä¼šæœ‰é—®é¢˜å—ï¼Ÿ

**A**: ä¸ä¼šï¼Œå› ä¸ºï¼š
- æ–°ç¼–è¾‘å™¨å‘å‰å…¼å®¹
- æ—§æ–‡ä»¶ç¼ºå°‘çš„å­—æ®µä¼šä½¿ç”¨é»˜è®¤å€¼
- æ•°æ®ä¸ä¼šä¸¢å¤±

**ç¤ºä¾‹ï¼š**
```
1.8.5 ç¼–è¾‘å™¨æ‰“å¼€ 1.7.0 æ–‡ä»¶
  â†“
ç¼ºå°‘ import å­—æ®µ
  â†“
è‡ªåŠ¨è¡¥å…… import = []
  â†“
æ­£å¸¸ç¼–è¾‘å’Œä¿å­˜
```

### Q3: æ–‡ä»¶ç‰ˆæœ¬ä¼šè‡ªåŠ¨æ›´æ–°å—ï¼Ÿ

**A**: ä¸ä¼šï¼

```
ç”¨ 1.7.0 åˆ›å»ºçš„æ–‡ä»¶ï¼šversion: "1.7.0"
  â†“
ç”¨ 1.8.5 ç¼–è¾‘å™¨æ‰“å¼€ã€ç¼–è¾‘ã€ä¿å­˜
  â†“
æ–‡ä»¶ä»ç„¶æ˜¯ï¼šversion: "1.7.0"  â† ä¸å˜
```

**åŸå› ï¼š**
- ç‰ˆæœ¬å·æ ‡è¯†æ–‡ä»¶çš„åˆ›å»ºç‰ˆæœ¬
- ä¸æ˜¯å½“å‰ç¼–è¾‘å™¨ç‰ˆæœ¬
- è¿½è¸ªæ–‡ä»¶å†å²

**å¦‚éœ€æ›´æ–°ï¼š**
- æ‰‹åŠ¨ä¿®æ”¹ JSON æ–‡ä»¶
- æˆ–ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬

### Q4: å¦‚ä½•çŸ¥é“ç¼–è¾‘å™¨çš„ç‰ˆæœ¬ï¼Ÿ

**A**: ä¸‰ç§æ–¹æ³•ï¼š

```
1. æŸ¥çœ‹æ ‡é¢˜æ 
   Behavior3 Editor - v1.8.5

2. å¸®åŠ©èœå• â†’ å…³äº
   æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

3. æŸ¥çœ‹ä»£ç 
   src/misc/b3type.ts:27
   package.json:3
```

### Q5: å‡çº§ç¼–è¾‘å™¨ä¼šå½±å“æ—§æ–‡ä»¶å—ï¼Ÿ

**A**: ä¸ä¼šï¼

```
å‡çº§ 1.8.0 â†’ 1.8.5
  â†“
æ—§æ–‡ä»¶ä»ç„¶å¯ä»¥æ­£å¸¸æ‰“å¼€ã€ç¼–è¾‘ã€ä¿å­˜
  â†“
æ–‡ä»¶ç‰ˆæœ¬å·ä¿æŒä¸å˜ï¼ˆé™¤éæ‰‹åŠ¨ä¿®æ”¹ï¼‰
  â†“
å®Œå…¨å‘å‰å…¼å®¹
```

**ä½†å»ºè®®ï¼š**
- å‡çº§åæµ‹è¯•å…³é”®æ–‡ä»¶
- æ£€æŸ¥æ˜¯å¦æœ‰è­¦å‘Šä¿¡æ¯
- å¿…è¦æ—¶æ›´æ–°æ–‡ä»¶ç‰ˆæœ¬å·

---

## ğŸ¯ ç‰ˆæœ¬ç®¡ç†æ£€æŸ¥æ¸…å•

### å¼€å‘æ—¶
- [ ] package.json å’Œ VERSION å¸¸é‡ä¿æŒä¸€è‡´
- [ ] æ·»åŠ æ–°åŠŸèƒ½æ—¶å†³å®šç‰ˆæœ¬é€’å¢ç­–ç•¥ï¼ˆmajor/minor/patchï¼‰
- [ ] æµ‹è¯•æ–°ç‰ˆæœ¬ä¸æ—§æ–‡ä»¶çš„å…¼å®¹æ€§
- [ ] æ›´æ–° CHANGELOGï¼ˆå¦‚æœæœ‰ï¼‰

### å‘å¸ƒæ—¶
- [ ] ç¡®å®šç‰ˆæœ¬å·ï¼ˆæ ¹æ®æ›´æ–°å†…å®¹ï¼‰
- [ ] æ›´æ–°ä¸¤å¤„ç‰ˆæœ¬å·ï¼ˆpackage.json å’Œ VERSION å¸¸é‡ï¼‰
- [ ] æµ‹è¯•æ–‡ä»¶å…¼å®¹æ€§
- [ ] åˆ›å»º Git tag
- [ ] å‘å¸ƒåˆ° GitHub Release

### å›¢é˜Ÿåä½œæ—¶
- [ ] æ–‡æ¡£ä¸­è¯´æ˜å½“å‰ç‰ˆæœ¬
- [ ] å›¢é˜Ÿæˆå‘˜ä½¿ç”¨ç›¸åŒç‰ˆæœ¬
- [ ] å‡çº§æ—¶é€šçŸ¥æ‰€æœ‰æˆå‘˜
- [ ] é‡åˆ°ç‰ˆæœ¬è­¦å‘Šæ—¶åŠæ—¶å¤„ç†

---

## ğŸ“š å‚è€ƒèµ„æ–™

### è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ
- å®˜æ–¹ç½‘ç«™ï¼šhttps://semver.org/lang/zh-CN/
- æ ¸å¿ƒåŸåˆ™ï¼šmajor.minor.patch
- ç‰ˆæœ¬é€’å¢è§„åˆ™

### npm version å‘½ä»¤
```bash
npm version patch   # 1.8.5 â†’ 1.8.6
npm version minor   # 1.8.5 â†’ 1.9.0
npm version major   # 1.8.5 â†’ 2.0.0
npm version <specific>  # æŒ‡å®šç‰ˆæœ¬å·
```

### Git æ ‡ç­¾
```bash
# æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾
git tag

# åˆ›å»ºæ ‡ç­¾
git tag v1.8.5

# æ¨é€æ ‡ç­¾
git push origin v1.8.5

# æ¨é€æ‰€æœ‰æ ‡ç­¾
git push origin --tags
```

---

## ğŸ”§ ç‰ˆæœ¬ç›¸å…³çš„æ–‡ä»¶è¯¦è§£

### 1. ç¼–è¾‘å™¨ç‰ˆæœ¬å®šä¹‰

#### 1.1 package.json
**æ–‡ä»¶è·¯å¾„ï¼š** `package.json:3`

```json
{
  "name": "behavior3editor",
  "version": "1.8.5",  â† åº”ç”¨ç‰ˆæœ¬
  "main": "dist-electron/main/index.js",
  "description": "è¡Œä¸ºæ ‘ç¼–è¾‘å™¨"
}
```

**ä½œç”¨ï¼š**
- npm åŒ…ç®¡ç†çš„æ ‡å‡†ç‰ˆæœ¬å­—æ®µ
- ç”¨äºæ„å»ºå’Œå‘å¸ƒ
- å®‰è£…åŒ…æ–‡ä»¶åï¼ˆå¦‚ `behavior3editor_1.8.5.exe`ï¼‰
- Electron è‡ªåŠ¨æ›´æ–°æ—¶çš„ç‰ˆæœ¬æ¯”å¯¹

**ä¿®æ”¹æ–¹å¼ï¼š**
```bash
# ä½¿ç”¨ npm å‘½ä»¤è‡ªåŠ¨æ›´æ–°
npm version patch  # 1.8.5 â†’ 1.8.6
npm version minor  # 1.8.5 â†’ 1.9.0
npm version major  # 1.8.5 â†’ 2.0.0
```

#### 1.2 src/misc/b3type.ts
**æ–‡ä»¶è·¯å¾„ï¼š** `src/misc/b3type.ts:27`

```typescript
/**
 * ç¼–è¾‘å™¨ç‰ˆæœ¬å·
 * 
 * ç”¨é€”ï¼š
 * - æ˜¾ç¤ºåœ¨æ ‡é¢˜æ å’Œå…³äºç•Œé¢
 * - æ£€æµ‹è¡Œä¸ºæ ‘æ–‡ä»¶çš„å…¼å®¹æ€§
 * - è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬æ¯”å¯¹
 */
export const VERSION = "1.8.5";
```

**ä½œç”¨ï¼š**
- è¿è¡Œæ—¶ä½¿ç”¨çš„ç‰ˆæœ¬å¸¸é‡
- ç”¨äºä¸æ–‡ä»¶ç‰ˆæœ¬æ¯”å¯¹
- åˆ›å»ºæ–°æ–‡ä»¶æ—¶çš„ç‰ˆæœ¬æ ‡è®°
- ç•Œé¢æ˜¾ç¤ºï¼ˆæ ‡é¢˜æ ã€å…³äºé¡µé¢ï¼‰

**ä¿®æ”¹æ–¹å¼ï¼š**
```typescript
// æ‰‹åŠ¨ä¿®æ”¹ï¼Œå¿…é¡»ä¸ package.json ä¿æŒä¸€è‡´
export const VERSION = "1.8.6";
```

**æ³¨æ„ï¼š** 
- npm version å‘½ä»¤ä¸ä¼šè‡ªåŠ¨æ›´æ–°æ­¤æ–‡ä»¶
- éœ€è¦æ‰‹åŠ¨åŒæ­¥
- å»ºè®®ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–

### 2. æ–‡ä»¶ç‰ˆæœ¬ï¼ˆè¡Œä¸ºæ ‘ JSON æ–‡ä»¶ï¼‰

#### 2.1 ä¸»è¡Œä¸ºæ ‘æ–‡ä»¶

**ç¤ºä¾‹ï¼š** `sample/workdir/hero.json:2`
```json
{
  "version": "1.8.0",  â† æ­¤æ–‡ä»¶ç”± 1.8.0 ç‰ˆæœ¬ç¼–è¾‘å™¨åˆ›å»º
  "name": "hero",
  "desc": "è‹±é›„æµ‹è¯•AI",
  "export": true,
  "group": ["Client", "Server"],
  "root": { ... }
}
```

**ç¤ºä¾‹ï¼š** `sample/workdir/monster.json:2`
```json
{
  "version": "1.8.0",
  "name": "monster",
  "desc": "æ€ªç‰©AI",
  ...
}
```

#### 2.2 å­æ ‘æ–‡ä»¶

**ç¤ºä¾‹ï¼š** `sample/workdir/sub/subtree1.json:2`
```json
{
  "version": "1.8.0",
  "name": "subtree1",
  "export": true,
  ...
}
```

#### 2.3 å˜é‡å£°æ˜æ–‡ä»¶

**ç¤ºä¾‹ï¼š** `sample/vars/declare-core.json:2`
```json
{
  "version": "1.8.0",
  "vars": [
    { "name": "hp", "desc": "ç”Ÿå‘½å€¼" },
    { "name": "mp", "desc": "é­”æ³•å€¼" }
  ]
}
```

**æ‰€æœ‰ç¤ºä¾‹æ–‡ä»¶çš„ç‰ˆæœ¬ï¼š**

| æ–‡ä»¶è·¯å¾„ | ç‰ˆæœ¬ | ç±»å‹ |
|---------|------|------|
| `sample/workdir/hero.json` | 1.8.0 | ä¸»è¡Œä¸ºæ ‘ |
| `sample/workdir/monster.json` | 1.8.0 | ä¸»è¡Œä¸ºæ ‘ |
| `sample/workdir/subtree1.json` | 1.8.0 | å­æ ‘ |
| `sample/workdir/subtree2.json` | 1.8.0 | å­æ ‘ |
| `sample/workdir/sub/subtree1.json` | 1.8.0 | å­æ ‘ |
| `sample/workdir/sub/subtree2.json` | 1.8.0 | å­æ ‘ |
| `sample/vars/declare-core.json` | 1.8.0 | å˜é‡å£°æ˜ |
| `sample/vars/declare-vars.json` | 1.8.0 | å˜é‡å£°æ˜ |
| `sample/vars/test-vars.json` | 1.8.0 | å˜é‡å£°æ˜ |
| `sample/vars/test-subtree.json` | 1.8.0 | å˜é‡å£°æ˜ |

**æ³¨æ„ï¼š**
- æ‰€æœ‰ç¤ºä¾‹æ–‡ä»¶ç‰ˆæœ¬ä¸º 1.8.0
- å½“å‰ç¼–è¾‘å™¨ç‰ˆæœ¬ä¸º 1.8.5
- æ‰“å¼€è¿™äº›æ–‡ä»¶ä¸ä¼šè­¦å‘Šï¼ˆå‘å‰å…¼å®¹ï¼‰

### 3. é…ç½®æ–‡ä»¶ï¼ˆæ— ç‰ˆæœ¬ï¼‰

ä»¥ä¸‹æ–‡ä»¶**æ²¡æœ‰**ç‰ˆæœ¬å­—æ®µï¼š

#### 3.1 å·¥ä½œåŒºé…ç½®
**æ–‡ä»¶è·¯å¾„ï¼š** `sample/workspace.b3-workspace`

```json
{
  "files": [ ... ],
  "settings": { ... }
}
```

**åŸå› ï¼š**
- å·¥ä½œåŒºé…ç½®æ ¼å¼å¾ˆå°‘å˜åŒ–
- ç›´æ¥è¯»å–ï¼Œä¸éœ€è¦ç‰ˆæœ¬æ£€æŸ¥

#### 3.2 èŠ‚ç‚¹å®šä¹‰é…ç½®
**æ–‡ä»¶è·¯å¾„ï¼š** `sample/node-config.b3-setting`

```json
{
  "name": "Wait",
  "type": "Action",
  "desc": "ç­‰å¾…æŒ‡å®šæ—¶é—´",
  ...
}
```

**åŸå› ï¼š**
- èŠ‚ç‚¹å®šä¹‰ç”±ä»£ç ç”Ÿæˆ
- æ¯æ¬¡åŠ è½½æ—¶é‡æ–°ç”Ÿæˆ
- ä¸éœ€è¦ç‰ˆæœ¬ç®¡ç†

### 4. ç‰ˆæœ¬ç›¸å…³çš„ä»£ç æ–‡ä»¶

#### 4.1 ç‰ˆæœ¬æ¯”è¾ƒé€»è¾‘

**æ–‡ä»¶è·¯å¾„ï¼š** `src/misc/b3util.ts:134-142`

```typescript
export const isNewVersion = (version: string) => {
  // è§£ææ–‡ä»¶ç‰ˆæœ¬å·ï¼šå¦‚ "1.8.5" â†’ [1, 8, 5]
  const [major, minor, patch] = version.split(".").map(Number);
  
  // è§£æç¼–è¾‘å™¨ç‰ˆæœ¬å·
  const [major2, minor2, patch2] = VERSION.split(".").map(Number);
  
  // è¯­ä¹‰åŒ–ç‰ˆæœ¬æ¯”è¾ƒ
  return (
    major > major2 ||                                      // ä¸»ç‰ˆæœ¬æ›´å¤§
    (major === major2 && minor > minor2) ||                // æ¬¡ç‰ˆæœ¬æ›´å¤§
    (major === major2 && minor === minor2 && patch > patch2) // è¡¥ä¸ç‰ˆæœ¬æ›´å¤§
  );
};
```

**å¯¼å…¥ï¼š**
```typescript
import { VERSION } from "./b3type";
```

#### 4.2 ç‰ˆæœ¬æ£€æŸ¥è°ƒç”¨

**æ–‡ä»¶è·¯å¾„ï¼š** `src/contexts/workspace-context.ts:902-924`

```typescript
open: (path, focusId) => {
  path = Path.posixPath(path);
  const workspace = get();
  
  let editor = workspace.editors.find((v) => v.path === path);
  
  if (!editor) {
    try {
      // åˆ›å»ºç¼–è¾‘å™¨ï¼Œè¯»å–æ–‡ä»¶
      editor = new EditorStore(path);
      workspace.editors.push(editor);
      set({ editors: workspace.editors });
      workspace.updateFileMeta(editor);
      workspace.edit(editor.path, focusId);

      // ========== ç‰ˆæœ¬æ£€æŸ¥ ==========
      if (b3util.isNewVersion(editor.data.version)) {
        message.warning(
          i18n.t("alertNewVersion", { version: editor.data.version })
        );
      }
      // =============================
    } catch (error) {
      console.error(error);
      message.error(`invalid file: ${path}`);
    }
  }
}
```

#### 4.3 åˆ›å»ºæ–‡ä»¶æ—¶è®¾ç½®ç‰ˆæœ¬

**æ–‡ä»¶è·¯å¾„ï¼š** `src/misc/b3util.ts:918-930`

```typescript
export const createNewTree = (path: string) => {
  const tree: TreeData = {
    version: VERSION,  // â† ä½¿ç”¨å½“å‰ç¼–è¾‘å™¨ç‰ˆæœ¬
    name: Path.basenameWithoutExt(path),
    prefix: "",
    group: [],
    import: [],
    vars: [],
    root: {
      id: "1",
      name: "Sequence",
      desc: "",
      children: [],
    },
  };
  return tree;
};
```

#### 4.4 å›½é™…åŒ–æ–‡æœ¬

**æ–‡ä»¶è·¯å¾„ï¼š** `public/locales/zh.json:5`
```json
{
  "alertNewVersion": "æ­¤æ–‡ä»¶ç”±æ–°ç‰ˆæœ¬ Behavior3({{version}}) åˆ›å»ºï¼Œè¯·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"
}
```

**æ–‡ä»¶è·¯å¾„ï¼š** `public/locales/en.json:5`
```json
{
  "alertNewVersion": "This file is created by a newer version of Behavior3({{version}}), please upgrade to the latest version."
}
```

### 5. å®Œæ•´çš„ç‰ˆæœ¬ç›¸å…³æ–‡ä»¶æ¸…å•

```
ğŸ“ ç‰ˆæœ¬å®šä¹‰
  â”œâ”€ package.json:3                          åº”ç”¨ç‰ˆæœ¬ (1.8.5)
  â””â”€ src/misc/b3type.ts:27                   VERSION å¸¸é‡ (1.8.5)

ğŸ“ ç‰ˆæœ¬ä½¿ç”¨ï¼ˆä»£ç ï¼‰
  â”œâ”€ src/misc/b3util.ts:134                  isNewVersion() ç‰ˆæœ¬æ¯”è¾ƒå‡½æ•°
  â”œâ”€ src/misc/b3util.ts:920                  createNewTree() è®¾ç½®æ–°æ–‡ä»¶ç‰ˆæœ¬
  â””â”€ src/contexts/workspace-context.ts:914   open() æ‰“å¼€æ–‡ä»¶æ—¶æ£€æŸ¥

ğŸ“ å›½é™…åŒ–æ–‡æœ¬
  â”œâ”€ public/locales/zh.json:5                ä¸­æ–‡è­¦å‘Š
  â””â”€ public/locales/en.json:5                è‹±æ–‡è­¦å‘Š

ğŸ“ ç¤ºä¾‹æ–‡ä»¶ç‰ˆæœ¬ï¼ˆå…¨éƒ¨ 1.8.0ï¼‰
  â”œâ”€ sample/workdir/hero.json:2              ä¸»è¡Œä¸ºæ ‘
  â”œâ”€ sample/workdir/monster.json:2           ä¸»è¡Œä¸ºæ ‘
  â”œâ”€ sample/workdir/subtree1.json:2          å­æ ‘
  â”œâ”€ sample/workdir/subtree2.json:2          å­æ ‘
  â”œâ”€ sample/workdir/sub/subtree1.json:2      å­æ ‘
  â”œâ”€ sample/workdir/sub/subtree2.json:2      å­æ ‘
  â”œâ”€ sample/vars/declare-core.json:2         å˜é‡å£°æ˜
  â”œâ”€ sample/vars/declare-vars.json:2         å˜é‡å£°æ˜
  â”œâ”€ sample/vars/test-vars.json:2            å˜é‡å£°æ˜
  â””â”€ sample/vars/test-subtree.json:2         å˜é‡å£°æ˜

ğŸ“ æ— ç‰ˆæœ¬æ–‡ä»¶
  â”œâ”€ sample/workspace.b3-workspace           å·¥ä½œåŒºé…ç½®
  â””â”€ sample/node-config.b3-setting           èŠ‚ç‚¹å®šä¹‰
```

### 6. ç‰ˆæœ¬å­—æ®µåœ¨æ•°æ®ç»“æ„ä¸­çš„ä½ç½®

#### 6.1 TypeScript æ¥å£å®šä¹‰

**æ–‡ä»¶è·¯å¾„ï¼š** `src/misc/b3type.ts:672-683`

```typescript
export interface TreeData {
  /**
   * è¡Œä¸ºæ ‘æ ¼å¼ç‰ˆæœ¬å·
   * 
   * ç”¨é€”ï¼š
   * - å…¼å®¹æ€§æ£€æŸ¥
   * - æ ¼å¼å‡çº§è¿ç§»
   * - ç¼–è¾‘å™¨ç‰ˆæœ¬éªŒè¯
   * 
   * é€šå¸¸ä¸ç¼–è¾‘å™¨ç‰ˆæœ¬ä¸€è‡´ï¼šVERSION å¸¸é‡
   */
  version: string;  â† ç‰ˆæœ¬å­—æ®µå®šä¹‰
  
  name: string;
  prefix: string;
  // ... å…¶ä»–å­—æ®µ
}
```

#### 6.2 EditorStore ä¸­çš„ç‰ˆæœ¬

**æ–‡ä»¶è·¯å¾„ï¼š** `src/contexts/workspace-context.ts:91-151`

```typescript
export class EditorStore {
  path: string;
  data: TreeData;  â† åŒ…å« version å­—æ®µ
  changed: boolean;
  mtime: number;
  
  constructor(path: string) {
    this.path = path;
    this.data = readTree(path);  â† è¯»å– JSONï¼ŒåŒ…æ‹¬ version
    this.data.name = Path.basenameWithoutExt(path);
    this.mtime = fs.statSync(path).mtimeMs;
    // ...
  }
}
```

---

## ğŸ“Š ç‰ˆæœ¬ç›¸å…³æ–‡ä»¶çš„æ•°æ®æµ

### 1. åˆ›å»ºæ–°æ–‡ä»¶æ—¶

```
ç”¨æˆ·ï¼šæ–°å»ºæ–‡ä»¶ â†’ test.json
  â†“
Explorer.tsx
  dispatch("newFile")
  â†“
åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ path = "/.json"
  â†“
ç”¨æˆ·è¾“å…¥æ–‡ä»¶å "test"
  â†“
submitRename()
  â”œâ”€ ç”Ÿæˆ TreeData
  â”‚  â””â”€ createNewTree("test.json")
  â”‚     â”œâ”€ è¯»å– VERSION å¸¸é‡ (1.8.5)
  â”‚     â””â”€ åˆ›å»º { version: "1.8.5", name: "test", ... }
  â”œâ”€ JSON.stringify(treeData)
  â””â”€ fs.writeFileSync("test.json", json)
  â†“
test.json æ–‡ä»¶åˆ›å»ºï¼ŒåŒ…å« version: "1.8.5"
```

**æ¶‰åŠæ–‡ä»¶ï¼š**
- `src/misc/b3type.ts` - VERSION å¸¸é‡æ¥æº
- `src/misc/b3util.ts` - createNewTree() å‡½æ•°
- `src/components/explorer.tsx` - æ–°å»ºæ–‡ä»¶é€»è¾‘

### 2. æ‰“å¼€æ–‡ä»¶æ—¶

```
ç”¨æˆ·ï¼šç‚¹å‡»æ–‡ä»¶æ ‘ä¸­çš„ hero.json
  â†“
Explorer.tsx
  onSelect â†’ dispatch("open")
  â†“
workspace.open("hero.json")
  â†“
new EditorStore("hero.json")
  â”œâ”€ readTree("hero.json")
  â”‚  â”œâ”€ fs.readFileSync("hero.json")
  â”‚  â”œâ”€ JSON.parse(content)
  â”‚  â””â”€ TreeData { version: "1.8.0", ... }
  â””â”€ this.data = treeData
  â†“
ç‰ˆæœ¬æ£€æŸ¥
  isNewVersion("1.8.0")
  â”œâ”€ æ–‡ä»¶ç‰ˆæœ¬ï¼š1.8.0
  â”œâ”€ ç¼–è¾‘å™¨ç‰ˆæœ¬ï¼š1.8.5
  â””â”€ 1.8.0 < 1.8.5 â†’ falseï¼ˆæ— éœ€è­¦å‘Šï¼‰
  â†“
æ­£å¸¸æ‰“å¼€æ–‡ä»¶
```

**æ¶‰åŠæ–‡ä»¶ï¼š**
- `src/contexts/workspace-context.ts` - open() æ–¹æ³•ï¼Œç‰ˆæœ¬æ£€æŸ¥
- `src/misc/b3util.ts` - isNewVersion() å‡½æ•°
- `src/misc/util.ts` - readTree() å‡½æ•°
- `public/locales/*.json` - è­¦å‘Šæ–‡æœ¬

### 3. ä¿å­˜æ–‡ä»¶æ—¶

```
ç”¨æˆ·ï¼šæŒ‰ Ctrl+S ä¿å­˜
  â†“
workspace.save()
  â†“
editor.dispatch("save")
  â†“
graph.save()
  â”œâ”€ æ”¶é›†æ‰€æœ‰ NodeData
  â”œâ”€ æ„å»º TreeData {
  â”‚    version: "1.8.0",  â† ä¿ç•™åŸæœ‰ç‰ˆæœ¬ï¼ˆä¸ä¿®æ”¹ï¼‰
  â”‚    name: "hero",
  â”‚    root: { ... }
  â”‚  }
  â””â”€ writeTree(path, treeData)
     â”œâ”€ JSON.stringify(treeData, null, 2)
     â””â”€ fs.writeFileSync(path, json)
  â†“
æ–‡ä»¶ä¿å­˜ï¼Œç‰ˆæœ¬å·ä¿æŒä¸å˜
```

**æ¶‰åŠæ–‡ä»¶ï¼š**
- `src/components/graph.ts` - save() æ–¹æ³•
- `src/misc/util.ts` - writeTree() å‡½æ•°

### 4. ç‰ˆæœ¬è­¦å‘Šæ˜¾ç¤ºæ—¶

```
æ‰“å¼€ hero.json (å‡è®¾ version: "1.9.0")
  â†“
workspace.open("hero.json")
  â†“
åˆ›å»º EditorStore
  â””â”€ this.data.version = "1.9.0"
  â†“
ç‰ˆæœ¬æ£€æŸ¥
  isNewVersion("1.9.0")
  â”œâ”€ æ–‡ä»¶ç‰ˆæœ¬ï¼š1.9.0
  â”œâ”€ ç¼–è¾‘å™¨ç‰ˆæœ¬ï¼š1.8.5
  â””â”€ 1.9.0 > 1.8.5 â†’ true âœ“
  â†“
æ˜¾ç¤ºè­¦å‘Š
  message.warning(
    i18n.t("alertNewVersion", { version: "1.9.0" })
  )
  â†“
ç•Œé¢å¼¹å‡ºæç¤ºï¼š
  "æ­¤æ–‡ä»¶ç”±æ–°ç‰ˆæœ¬ Behavior3(1.9.0) åˆ›å»ºï¼Œè¯·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚"
  â†“
æ–‡ä»¶ä»ç„¶æ‰“å¼€ï¼ˆå…è®¸ç¼–è¾‘ï¼Œä½†å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ï¼‰
```

**æ¶‰åŠæ–‡ä»¶ï¼š**
- `src/contexts/workspace-context.ts` - ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘
- `src/misc/b3util.ts` - isNewVersion() å‡½æ•°
- `src/misc/i18n.ts` - å›½é™…åŒ–ç³»ç»Ÿ
- `public/locales/zh.json` - è­¦å‘Šæ–‡æœ¬
- `src/misc/hooks.ts` - message ç»„ä»¶ï¼ˆAntDï¼‰

---

## ğŸ” ä»£ç ä½ç½®ç´¢å¼•

### å®šä¹‰ä½ç½®
```typescript
// ç¼–è¾‘å™¨ç‰ˆæœ¬
package.json:3                     "version": "1.8.5"
src/misc/b3type.ts:27              export const VERSION = "1.8.5"

// æ–‡ä»¶ç‰ˆæœ¬ï¼ˆæ¥å£å®šä¹‰ï¼‰
src/misc/b3type.ts:672-683         interface TreeData { version: string; ... }
```

### ä½¿ç”¨ä½ç½®
```typescript
// ç‰ˆæœ¬æ¯”è¾ƒ
src/misc/b3util.ts:134-142         isNewVersion(version: string): boolean

// åˆ›å»ºæ–‡ä»¶
src/misc/b3util.ts:918-930         createNewTree() è®¾ç½® version: VERSION

// æ‰“å¼€æ–‡ä»¶æ£€æŸ¥
src/contexts/workspace-context.ts:914-916  
  if (b3util.isNewVersion(editor.data.version)) { ... }

// è¯»å–æ–‡ä»¶
src/misc/util.ts                   readTree(path): TreeData
  â””â†’ è§£æ JSONï¼ŒåŒ…å« version å­—æ®µ

// ä¿å­˜æ–‡ä»¶
src/misc/util.ts                   writeTree(path, tree)
  â””â†’ åºåˆ—åŒ– TreeDataï¼ŒåŒ…å« version å­—æ®µ
```

### å›½é™…åŒ–æ–‡æœ¬
```typescript
public/locales/zh.json:5           "alertNewVersion": "..."
public/locales/en.json:5           "alertNewVersion": "..."
src/misc/i18n.ts                   å›½é™…åŒ–åˆå§‹åŒ–
```

### ç•Œé¢æ˜¾ç¤ºï¼ˆè®¡åˆ’ä¸­ï¼‰
```typescript
// æ ‡é¢˜æ å¯èƒ½æ˜¾ç¤ºç‰ˆæœ¬ï¼ˆå½“å‰æœªå®ç°ï¼‰
src/components/titlebar.tsx       å¯æ·»åŠ ç‰ˆæœ¬æ˜¾ç¤º

// å…³äºå¯¹è¯æ¡†æ˜¾ç¤ºç‰ˆæœ¬ï¼ˆå½“å‰æœªå®ç°ï¼‰
// å¯åœ¨èœå•ä¸­æ·»åŠ  "å…³äº" â†’ æ˜¾ç¤º VERSION
```

---

## ğŸ› ï¸ ç‰ˆæœ¬ç®¡ç†å·¥å…·

### 1. è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆå»ºè®®æ·»åŠ ï¼‰

#### 1.1 ç‰ˆæœ¬åŒæ­¥è„šæœ¬

**åˆ›å»ºæ–‡ä»¶ï¼š** `scripts/sync-version.js`

```javascript
/**
 * è‡ªåŠ¨åŒæ­¥ package.json å’Œ VERSION å¸¸é‡
 */
const fs = require('fs');
const path = require('path');

// è¯»å– package.json
const pkg = require('../package.json');
const version = pkg.version;

// æ›´æ–° b3type.ts
const b3typePath = path.join(__dirname, '../src/misc/b3type.ts');
let content = fs.readFileSync(b3typePath, 'utf8');

// æ›¿æ¢ VERSION å¸¸é‡
content = content.replace(
  /export const VERSION = "[^"]+"/,
  `export const VERSION = "${version}"`
);

fs.writeFileSync(b3typePath, content);

console.log(`Version synced to: ${version}`);
```

**ä½¿ç”¨ï¼š**
```bash
# 1. æ›´æ–° package.json ç‰ˆæœ¬
npm version patch

# 2. è‡ªåŠ¨åŒæ­¥åˆ° VERSION å¸¸é‡
node scripts/sync-version.js
```

#### 1.2 æ–‡ä»¶ç‰ˆæœ¬ç»Ÿä¸€è„šæœ¬

**åˆ›å»ºæ–‡ä»¶ï¼š** `scripts/update-file-versions.js`

```javascript
/**
 * æ‰¹é‡æ›´æ–°æ‰€æœ‰è¡Œä¸ºæ ‘æ–‡ä»¶çš„ç‰ˆæœ¬å·
 */
const fs = require('fs');
const glob = require('glob');

const NEW_VERSION = process.argv[2] || "1.8.5";

glob("sample/**/*.json", (err, files) => {
  if (err) {
    console.error(err);
    return;
  }
  
  files.forEach(file => {
    try {
      const content = fs.readFileSync(file, 'utf8');
      const tree = JSON.parse(content);
      
      // åªæ›´æ–°è¡Œä¸ºæ ‘æ–‡ä»¶ï¼ˆæœ‰ root å­—æ®µï¼‰
      if (tree.root) {
        tree.version = NEW_VERSION;
        fs.writeFileSync(file, JSON.stringify(tree, null, 2));
        console.log(`Updated: ${file} -> ${NEW_VERSION}`);
      }
    } catch (error) {
      console.error(`Error processing ${file}:`, error.message);
    }
  });
});
```

**ä½¿ç”¨ï¼š**
```bash
# æ›´æ–°æ‰€æœ‰æ–‡ä»¶åˆ° 1.8.5
node scripts/update-file-versions.js 1.8.5
```

### 2. package.json æ·»åŠ è„šæœ¬

```json
{
  "scripts": {
    "version:sync": "node scripts/sync-version.js",
    "version:update-files": "node scripts/update-file-versions.js"
  }
}
```

**ä½¿ç”¨ï¼š**
```bash
# å‘å¸ƒæ–°ç‰ˆæœ¬çš„å®Œæ•´æµç¨‹
npm version patch        # æ›´æ–° package.json
npm run version:sync     # åŒæ­¥åˆ° VERSION å¸¸é‡
npm run build            # æ„å»º
npm run dist             # æ‰“åŒ…
```

---

## ğŸ‰ æ€»ç»“

### ç‰ˆæœ¬ç³»ç»Ÿçš„æ ¸å¿ƒä½œç”¨

1. **æ ‡è¯†å’Œè¿½è¸ª**
   - æ ‡è¯†ç¼–è¾‘å™¨ç‰ˆæœ¬
   - æ ‡è¯†æ–‡ä»¶åˆ›å»ºç‰ˆæœ¬
   - è¿½è¸ªæ ¼å¼æ¼”è¿›å†å²

2. **å…¼å®¹æ€§ä¿éšœ**
   - å‘å‰å…¼å®¹ï¼šæ–°ç¼–è¾‘å™¨è¯»æ—§æ–‡ä»¶
   - å‘åè­¦å‘Šï¼šæ—§ç¼–è¾‘å™¨è¯»æ–°æ–‡ä»¶æ—¶æç¤º
   - é¿å…æ•°æ®æŸå

3. **å›¢é˜Ÿåä½œ**
   - ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´æ€§
   - åŠæ—¶å‘ç°ç‰ˆæœ¬é—®é¢˜
   - åè°ƒå‡çº§æ—¶æœº

4. **æ ¼å¼æ¼”è¿›**
   - æ”¯æŒæ•°æ®æ ¼å¼å‡çº§
   - è®°å½•åŠŸèƒ½å˜åŒ–
   - æä¾›è¿ç§»è·¯å¾„

### è®°ä½

**ç‰ˆæœ¬å·ä¸æ˜¯è£…é¥°ï¼Œè€Œæ˜¯ï¼š**
- âœ… æ•°æ®å®Œæ•´æ€§çš„ä¿éšœ
- âœ… å›¢é˜Ÿåä½œçš„åŸºç¡€
- âœ… æ ¼å¼æ¼”è¿›çš„è®°å½•

**æœ€ä½³å®è·µï¼š**
- ä¿æŒä¸¤å¤„ç‰ˆæœ¬å·ä¸€è‡´
- å›¢é˜Ÿä½¿ç”¨ç›¸åŒç‰ˆæœ¬
- é‡åˆ°ç‰ˆæœ¬è­¦å‘ŠåŠæ—¶å¤„ç†
- å‡çº§æ—¶åšå¥½æµ‹è¯•å’Œå¤‡ä»½

