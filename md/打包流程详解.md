# Behavior3Editor æ‰“åŒ…æµç¨‹è¯¦è§£

## ğŸ“‹ ç›®å½•

1. [æ‰“åŒ…å·¥å…·é“¾](#æ‰“åŒ…å·¥å…·é“¾)
2. [æ„å»ºæµç¨‹](#æ„å»ºæµç¨‹)
3. [è¯¦ç»†æ­¥éª¤è§£æ](#è¯¦ç»†æ­¥éª¤è§£æ)
4. [é…ç½®æ–‡ä»¶è¯¦è§£](#é…ç½®æ–‡ä»¶è¯¦è§£)
5. [è¾“å‡ºæ–‡ä»¶è¯´æ˜](#è¾“å‡ºæ–‡ä»¶è¯´æ˜)
6. [å¹³å°ç‰¹å®šé…ç½®](#å¹³å°ç‰¹å®šé…ç½®)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ› ï¸ æ‰“åŒ…å·¥å…·é“¾

è¿™ä¸ªé¡¹ç›®ä½¿ç”¨äº†ç°ä»£åŒ–çš„ Electron æ‰“åŒ…æ–¹æ¡ˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ‰“åŒ…å·¥å…·é“¾                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  TypeScript (tsc)                                       â”‚
â”‚  â””â”€> ç±»å‹æ£€æŸ¥                                           â”‚
â”‚                                                         â”‚
â”‚  Vite                                                   â”‚
â”‚  â”œâ”€> ç¼–è¯‘ä¸»è¿›ç¨‹ (electron/main/index.ts)               â”‚
â”‚  â”œâ”€> ç¼–è¯‘é¢„åŠ è½½è„šæœ¬ (electron/preload/index.ts)        â”‚
â”‚  â””â”€> ç¼–è¯‘æ¸²æŸ“è¿›ç¨‹ (src/**/*.tsx)                       â”‚
â”‚                                                         â”‚
â”‚  electron-builder                                       â”‚
â”‚  â””â”€> æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶ (.exe, .dmg, .zip)               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒå·¥å…·

| å·¥å…· | ç‰ˆæœ¬ | ä½œç”¨ |
|-----|------|------|
| **TypeScript** | 5.8.2 | ç±»å‹æ£€æŸ¥å’Œç¼–è¯‘ |
| **Vite** | 6.3.5 | ç°ä»£åŒ–æ„å»ºå·¥å…· |
| **vite-plugin-electron** | 0.29.0 | Vite çš„ Electron æ’ä»¶ |
| **electron-builder** | 24.13.3 | Electron åº”ç”¨æ‰“åŒ…å·¥å…· |
| **React** | 18.3.1 | UI æ¡†æ¶ |
| **Electron** | 33.2.0 | æ¡Œé¢åº”ç”¨æ¡†æ¶ |

---

## ğŸ”„ æ„å»ºæµç¨‹

### ä¸€é”®æ„å»ºå‘½ä»¤

```bash
npm run build
```

### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      npm run build                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“              â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  tsc  â”‚    â”‚   vite   â”‚   â”‚ electron-builderâ”‚
    â”‚       â”‚    â”‚  build   â”‚   â”‚                 â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚                  â”‚
        â†“             â†“                  â†“
   ç±»å‹æ£€æŸ¥      ç¼–è¯‘ä»£ç            æ‰“åŒ…å¯æ‰§è¡Œæ–‡ä»¶
   (ä¸ç”Ÿæˆä»£ç )  â”œâ”€ ä¸»è¿›ç¨‹           â”œâ”€ Windows: .exe
                 â”œâ”€ é¢„åŠ è½½           â”œâ”€ macOS: .dmg, .zip
                 â””â”€ æ¸²æŸ“è¿›ç¨‹         â””â”€ Linux: .AppImage
        â”‚             â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
             release/1.8.5/ ç›®å½•
             â”œâ”€ behavior3editor_1.8.5.exe (Windows)
             â”œâ”€ behavior3editor_1.8.5.dmg (macOS)
             â””â”€ behavior3editor_1.8.5.zip (macOS)
```

---

## ğŸ“ è¯¦ç»†æ­¥éª¤è§£æ

### æ­¥éª¤ 1ï¼šTypeScript ç±»å‹æ£€æŸ¥

```bash
tsc
```

**ä½œç”¨**ï¼š
- æ£€æŸ¥ TypeScript ç±»å‹é”™è¯¯
- **ä¸ç”Ÿæˆ**ä»»ä½• JavaScript æ–‡ä»¶ï¼ˆ`--noEmit` é…ç½®åœ¨ `tsconfig.json` ä¸­ï¼‰
- ç¡®ä¿ä»£ç ç±»å‹å®‰å…¨

**é…ç½®æ–‡ä»¶**ï¼š`tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "jsx": "react-jsx",
    "strict": true,
    // ... å…¶ä»–é…ç½®
  }
}
```

**ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ**
- æ•è·ç±»å‹é”™è¯¯
- æé«˜ä»£ç è´¨é‡
- IDE æ™ºèƒ½æç¤ºæ”¯æŒ

---

### æ­¥éª¤ 2ï¼šVite æ„å»º

```bash
vite build
```

è¿™ä¸€æ­¥ä¼šç¼–è¯‘ä¸‰ä¸ªéƒ¨åˆ†ï¼š

#### 2.1 ä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰

**å…¥å£æ–‡ä»¶**ï¼š`electron/main/index.ts`

**è¾“å‡ºç›®å½•**ï¼š`dist-electron/main/`

```
electron/main/index.ts
      â†“ [Vite + TypeScript]
dist-electron/main/index.js
```

**æ„å»ºé…ç½®**ï¼ˆ`vite.config.ts`ï¼‰ï¼š

```javascript
main: {
  entry: "electron/main/index.ts",
  vite: {
    build: {
      sourcemap: true,              // ç”Ÿæˆ source map
      target: ["chrome89", ...],    // ç›®æ ‡æµè§ˆå™¨ç‰ˆæœ¬
      minify: false,                // ä¸å‹ç¼©ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
      outDir: "dist-electron/main", // è¾“å‡ºç›®å½•
      rollupOptions: {
        external: Object.keys(pkg.dependencies), // å¤–éƒ¨ä¾èµ–
      },
    },
  },
}
```

**å…³é”®ç‚¹**ï¼š
- ä¸æ‰“åŒ… `dependencies` ä¸­çš„åŒ…ï¼ˆä¿æŒä¸º `require()` è°ƒç”¨ï¼‰
- ç”Ÿæˆ source map ä¾¿äºè°ƒè¯•
- ä¸å‹ç¼©ä»£ç ï¼ˆå¯é…ç½®ï¼‰

#### 2.2 é¢„åŠ è½½è„šæœ¬ï¼ˆPreload Scriptï¼‰

**å…¥å£æ–‡ä»¶**ï¼š`electron/preload/index.ts`

**è¾“å‡ºç›®å½•**ï¼š`dist-electron/preload/`

```
electron/preload/index.ts
      â†“ [Vite + TypeScript]
dist-electron/preload/index.mjs
```

**æ„å»ºé…ç½®**ï¼š

```javascript
preload: {
  input: "electron/preload/index.ts",
  vite: {
    build: {
      sourcemap: "inline",            // å†…è” source map
      minify: false,
      outDir: "dist-electron/preload",
      rollupOptions: {
        external: Object.keys(pkg.dependencies),
      },
    },
  },
}
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨å†…è” source map
- è¾“å‡ºä¸º ES Module (`.mjs`)

#### 2.3 æ¸²æŸ“è¿›ç¨‹ï¼ˆRenderer Processï¼‰

**å…¥å£æ–‡ä»¶**ï¼š`index.html` â†’ `src/main.tsx`

**è¾“å‡ºç›®å½•**ï¼š`dist/`

```
index.html
  â†“
src/main.tsx
  â†“
src/components/**/*.tsx
  â†“ [Vite + React + TypeScript]
dist/
â”œâ”€â”€ index.html
â””â”€â”€ assets/
    â”œâ”€â”€ index-[hash].js
    â”œâ”€â”€ index-[hash].css
    â””â”€â”€ ...
```

**æ„å»ºé…ç½®**ï¼ˆVite é»˜è®¤é…ç½®ï¼‰ï¼š

```javascript
build: {
  sourcemap: true,
  // é»˜è®¤æ„å»ºä¸ºç”Ÿäº§æ¨¡å¼çš„ React åº”ç”¨
}
```

**å…³é”®ç‚¹**ï¼š
- æ‰“åŒ…æ‰€æœ‰ React ç»„ä»¶
- ä»£ç åˆ†å‰²å’Œä¼˜åŒ–
- CSS æå–å’Œå‹ç¼©
- èµ„æºæ–‡ä»¶å¤„ç†ï¼ˆå›¾æ ‡ã€å­—ä½“ç­‰ï¼‰

---

### æ­¥éª¤ 3ï¼šelectron-builder æ‰“åŒ…

```bash
electron-builder
```

**ä½œç”¨**ï¼š
- å°†ç¼–è¯‘å¥½çš„ä»£ç æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶
- ç”Ÿæˆå®‰è£…åŒ…
- ä»£ç ç­¾åï¼ˆå¯é€‰ï¼‰
- è‡ªåŠ¨æ›´æ–°æ”¯æŒï¼ˆå¯é€‰ï¼‰

**é…ç½®æ–‡ä»¶**ï¼š`electron-builder.json`

```json
{
  "appId": "behavior3editor",
  "productName": "Behavior3 Editor",
  "asar": true,
  "directories": {
    "output": "release/${version}"
  },
  "files": ["dist-electron", "dist"],
  // ... å¹³å°ç‰¹å®šé…ç½®
}
```

**å·¥ä½œæµç¨‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    electron-builder æ‰“åŒ…æµç¨‹             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ 1. è¯»å– package.json                    â”‚
â”‚    â”œâ”€ name: behavior3editor            â”‚
â”‚    â”œâ”€ version: 1.8.5                   â”‚
â”‚    â””â”€ main: dist-electron/main/index.jsâ”‚
â”‚                                         â”‚
â”‚ 2. å¤åˆ¶æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•                   â”‚
â”‚    â”œâ”€ dist-electron/ (Electron ä»£ç )   â”‚
â”‚    â””â”€ dist/ (React åº”ç”¨)               â”‚
â”‚                                         â”‚
â”‚ 3. å®‰è£…ç”Ÿäº§ä¾èµ–                         â”‚
â”‚    â””â”€ npm install --production         â”‚
â”‚                                         â”‚
â”‚ 4. æ‰“åŒ…æˆ ASAR å½’æ¡£                     â”‚
â”‚    â””â”€ app.asar (å‹ç¼©çš„åº”ç”¨ä»£ç )         â”‚
â”‚                                         â”‚
â”‚ 5. åµŒå…¥ Electron è¿è¡Œæ—¶                â”‚
â”‚    â”œâ”€ electron.exe (Windows)           â”‚
â”‚    â””â”€ Electron.app (macOS)             â”‚
â”‚                                         â”‚
â”‚ 6. ç”Ÿæˆå®‰è£…åŒ…                           â”‚
â”‚    â”œâ”€ NSIS å®‰è£…å™¨ (Windows)            â”‚
â”‚    â”œâ”€ DMG é•œåƒ (macOS)                 â”‚
â”‚    â””â”€ ZIP å‹ç¼©åŒ… (ä¾¿æºç‰ˆ)              â”‚
â”‚                                         â”‚
â”‚ 7. è¾“å‡ºåˆ° release/ ç›®å½•                â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£

### 1. `package.json`

```json
{
  "name": "behavior3editor",
  "version": "1.8.5",                    // ç‰ˆæœ¬å·ï¼ˆè‡ªåŠ¨æ›´æ–°æ£€æµ‹ç”¨ï¼‰
  "main": "dist-electron/main/index.js", // ä¸»è¿›ç¨‹å…¥å£
  "type": "module",                      // ä½¿ç”¨ ES Module
  
  "scripts": {
    "dev": "vite",                       // å¼€å‘æ¨¡å¼
    "build": "tsc && vite build && electron-builder", // æ„å»º
    "preview": "vite preview",           // é¢„è§ˆæ„å»ºç»“æœ
  },
  
  "dependencies": {
    // ç”Ÿäº§ç¯å¢ƒä¾èµ–ï¼ˆä¼šè¢«æ‰“åŒ…åˆ°åº”ç”¨ä¸­ï¼‰
    "@ant-design/icons": "^5.4.0",
    "antd": "^5.20.0",
    "react": "^18.3.1",
    // ...
  },
  
  "devDependencies": {
    // å¼€å‘ä¾èµ–ï¼ˆä¸ä¼šè¢«æ‰“åŒ…ï¼‰
    "electron": "^33.2.0",
    "electron-builder": "^24.13.3",
    "vite": "^6.3.5",
    // ...
  }
}
```

**å…³é”®å­—æ®µ**ï¼š
- `main`: Electron å¯åŠ¨æ—¶åŠ è½½çš„æ–‡ä»¶
- `type`: ä½¿ç”¨ ES Module è¯­æ³•
- `version`: åº”ç”¨ç‰ˆæœ¬å·

---

### 2. `electron-builder.json`

```json
{
  "$schema": "https://raw.githubusercontent.com/electron-userland/electron-builder/master/packages/app-builder-lib/scheme.json",
  
  // åŸºç¡€é…ç½®
  "appId": "behavior3editor",              // åº”ç”¨å”¯ä¸€æ ‡è¯†
  "productName": "Behavior3 Editor",       // åº”ç”¨æ˜¾ç¤ºåç§°
  "asar": true,                            // ä½¿ç”¨ ASAR å½’æ¡£ï¼ˆå‹ç¼©ä»£ç ï¼‰
  
  // è¾“å‡ºç›®å½•
  "directories": {
    "output": "release/${version}"         // è¾“å‡ºåˆ° release/1.8.5/
  },
  
  // è¦æ‰“åŒ…çš„æ–‡ä»¶
  "files": [
    "dist-electron",                       // Electron ä»£ç 
    "dist"                                 // React åº”ç”¨
  ],
  
  // macOS é…ç½®
  "mac": {
    "artifactName": "behavior3editor_${version}.${ext}",
    "target": ["dmg", "zip"]               // ç”Ÿæˆ DMG å’Œ ZIP
  },
  
  // Windows é…ç½®
  "win": {
    "target": [
      {
        "target": "nsis",                  // NSIS å®‰è£…å™¨
        "arch": ["x64"]                    // 64 ä½
      }
    ],
    "artifactName": "behavior3editor_${version}.${ext}"
  },
  
  // NSIS å®‰è£…å™¨é…ç½®ï¼ˆWindowsï¼‰
  "nsis": {
    "oneClick": false,                     // éä¸€é”®å®‰è£…ï¼ˆæ˜¾ç¤ºå®‰è£…ç•Œé¢ï¼‰
    "perMachine": false,                   // ä¸ºå½“å‰ç”¨æˆ·å®‰è£…ï¼ˆéç³»ç»Ÿçº§ï¼‰
    "allowToChangeInstallationDirectory": true, // å…è®¸é€‰æ‹©å®‰è£…ç›®å½•
    "deleteAppDataOnUninstall": false      // å¸è½½æ—¶ä¿ç•™ç”¨æˆ·æ•°æ®
  },
  
  // è‡ªåŠ¨æ›´æ–°é…ç½®ï¼ˆå¯é€‰ï¼‰
  "publish": {
    "provider": "generic",
    "channel": "latest",
    "url": "https://github.com/electron-vite/electron-vite-react/releases/download/v0.9.9/"
  }
}
```

---

### 3. `vite.config.ts`

```typescript
export default defineConfig(({ command }) => {
  // æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
  rmSync("dist-electron", { recursive: true, force: true });

  return {
    // è·¯å¾„åˆ«å
    resolve: {
      alias: {
        "@": path.join(__dirname, "src"),   // @/components -> src/components
      },
    },
    
    // æ„å»ºé…ç½®
    build: {
      sourcemap: true,                       // ç”Ÿæˆ source map
    },
    
    // æ’ä»¶
    plugins: [
      react(),                               // React æ”¯æŒ
      electron({
        main: { /* ä¸»è¿›ç¨‹é…ç½® */ },
        preload: { /* é¢„åŠ è½½è„šæœ¬é…ç½® */ },
        renderer: {},
      }),
    ],
    
    // å¼€å‘æœåŠ¡å™¨é…ç½®
    server: {
      host: "127.0.0.1",
      port: 7777,
    },
  };
});
```

---

## ğŸ“¦ è¾“å‡ºæ–‡ä»¶è¯´æ˜

### æ„å»ºäº§ç‰©ç›®å½•ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ dist-electron/           # Electron è¿›ç¨‹ä»£ç ï¼ˆç¼–è¯‘åï¼‰
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ index.js        # ä¸»è¿›ç¨‹
â”‚   â”‚   â””â”€â”€ index.js.map    # Source map
â”‚   â””â”€â”€ preload/
â”‚       â”œâ”€â”€ index.mjs       # é¢„åŠ è½½è„šæœ¬
â”‚       â””â”€â”€ index.mjs.map   # Source map
â”‚
â”œâ”€â”€ dist/                    # React åº”ç”¨ï¼ˆç¼–è¯‘åï¼‰
â”‚   â”œâ”€â”€ index.html          # HTML å…¥å£
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ index-[hash].js # React åº”ç”¨ä»£ç 
â”‚       â”œâ”€â”€ index-[hash].css# æ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ ...             # å…¶ä»–èµ„æº
â”‚
â””â”€â”€ release/                 # æœ€ç»ˆæ‰“åŒ…æ–‡ä»¶
    â””â”€â”€ 1.8.5/
        â”œâ”€â”€ behavior3editor_1.8.5.exe        (Windows å®‰è£…å™¨)
        â”œâ”€â”€ behavior3editor_1.8.5.exe.blockmap
        â”œâ”€â”€ behavior3editor_1.8.5.dmg        (macOS é•œåƒ)
        â”œâ”€â”€ behavior3editor_1.8.5.dmg.blockmap
        â”œâ”€â”€ behavior3editor_1.8.5.zip        (macOS å‹ç¼©åŒ…)
        â”œâ”€â”€ latest.yml                        (è‡ªåŠ¨æ›´æ–°é…ç½®)
        â””â”€â”€ latest-mac.yml
```

### æ–‡ä»¶è¯´æ˜

#### `dist-electron/`

ç¼–è¯‘åçš„ Electron ä»£ç ï¼ŒåŒ…å«ï¼š
- **ä¸»è¿›ç¨‹**ï¼šNode.js ç¯å¢ƒï¼Œç®¡ç†çª—å£å’Œç”Ÿå‘½å‘¨æœŸ
- **é¢„åŠ è½½è„šæœ¬**ï¼šåœ¨æ¸²æŸ“è¿›ç¨‹åˆ›å»ºå‰æ‰§è¡Œ

#### `dist/`

ç¼–è¯‘åçš„ React åº”ç”¨ï¼ŒåŒ…å«ï¼š
- HTMLã€CSSã€JavaScript
- å›¾æ ‡ã€å­—ä½“ç­‰é™æ€èµ„æº
- å·²ä¼˜åŒ–å’Œå‹ç¼©

#### `release/1.8.5/`

æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š

| æ–‡ä»¶ | å¹³å° | ç±»å‹ | è¯´æ˜ |
|-----|------|------|------|
| `*.exe` | Windows | å®‰è£…å™¨ | NSIS å®‰è£…ç¨‹åº |
| `*.dmg` | macOS | é•œåƒ | ç£ç›˜é•œåƒæ–‡ä»¶ |
| `*.zip` | macOS | å‹ç¼©åŒ… | ä¾¿æºç‰ˆ |
| `*.blockmap` | æ‰€æœ‰ | å·®å¼‚æ–‡ä»¶ | è‡ªåŠ¨æ›´æ–°ç”¨ |
| `latest*.yml` | æ‰€æœ‰ | é…ç½® | è‡ªåŠ¨æ›´æ–°é…ç½® |

---

## ğŸ–¥ï¸ å¹³å°ç‰¹å®šé…ç½®

### Windows

```json
"win": {
  "target": [{
    "target": "nsis",              // ä½¿ç”¨ NSIS å®‰è£…å™¨
    "arch": ["x64"]                // 64 ä½æ¶æ„
  }],
  "artifactName": "behavior3editor_${version}.${ext}"
}
```

**NSIS é…ç½®**ï¼š
```json
"nsis": {
  "oneClick": false,               // æ˜¾ç¤ºå®‰è£…ç•Œé¢ï¼ˆéä¸€é”®å®‰è£…ï¼‰
  "perMachine": false,             // ç”¨æˆ·çº§å®‰è£…ï¼ˆæ— éœ€ç®¡ç†å‘˜æƒé™ï¼‰
  "allowToChangeInstallationDirectory": true, // å¯é€‰æ‹©å®‰è£…ä½ç½®
  "deleteAppDataOnUninstall": false // ä¿ç•™ç”¨æˆ·æ•°æ®
}
```

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `behavior3editor_1.8.5.exe` - NSIS å®‰è£…å™¨ï¼ˆçº¦ 100-200 MBï¼‰
- å®‰è£…åä½ç½®ï¼š`%LOCALAPPDATA%\Programs\Behavior3 Editor\`

---

### macOS

```json
"mac": {
  "artifactName": "behavior3editor_${version}.${ext}",
  "target": ["dmg", "zip"]         // ç”Ÿæˆ DMG å’Œ ZIP ä¸¤ç§æ ¼å¼
}
```

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `behavior3editor_1.8.5.dmg` - ç£ç›˜é•œåƒæ–‡ä»¶
  - ç”¨æˆ·å¯ä»¥æ‹–æ‹½åˆ° Applications æ–‡ä»¶å¤¹å®‰è£…
- `behavior3editor_1.8.5.zip` - ä¾¿æºç‰ˆå‹ç¼©åŒ…
  - è§£å‹å³ç”¨ï¼Œæ— éœ€å®‰è£…

**ä»£ç ç­¾å**ï¼ˆå¯é€‰ï¼‰ï¼š
```json
"mac": {
  "identity": "Developer ID Application: Your Name (TEAMID)",
  "hardenedRuntime": true,
  "gatekeeperAssess": false
}
```

---

### Linuxï¼ˆæœªé…ç½®ï¼‰

å¦‚éœ€ Linux æ”¯æŒï¼Œå¯æ·»åŠ ï¼š

```json
"linux": {
  "target": ["AppImage", "deb", "rpm"],
  "category": "Development"
}
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. ä¸ºä»€ä¹ˆæ„å»ºè¿™ä¹ˆæ…¢ï¼Ÿ

**åŸå› **ï¼š
- TypeScript ç±»å‹æ£€æŸ¥
- Vite ç¼–è¯‘ä¸‰ä¸ªéƒ¨åˆ†
- electron-builder æ‰“åŒ…å’Œå‹ç¼©
- å®‰è£…ç”Ÿäº§ä¾èµ–

**ä¼˜åŒ–**ï¼š
```json
// vite.config.ts
{
  "minify": false,        // å¼€å‘æ—¶ä¸å‹ç¼©
  "sourcemap": false,     // ä¸éœ€è¦æ—¶ç¦ç”¨ source map
}
```

---

### 2. ASAR æ˜¯ä»€ä¹ˆï¼Ÿ

**ASAR**ï¼ˆAtom Shell Archiveï¼‰æ˜¯ä¸€ç§å½’æ¡£æ ¼å¼ï¼š

```
app.asar
â”œâ”€â”€ dist-electron/
â”œâ”€â”€ dist/
â”œâ”€â”€ node_modules/
â””â”€â”€ package.json
```

**ä¼˜ç‚¹**ï¼š
- âœ… å‹ç¼©æ–‡ä»¶å¤§å°ï¼ˆå‡å°‘ 30-50%ï¼‰
- âœ… åŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼ˆå•æ–‡ä»¶è¯»å–ï¼‰
- âœ… ç®€å•çš„ä»£ç ä¿æŠ¤ï¼ˆä¸æ˜¯åŠ å¯†ï¼‰

**ç¼ºç‚¹**ï¼š
- âš ï¸ æ— æ³•ä¿®æ”¹æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
- âš ï¸ æŸäº› Node.js API å¯èƒ½ä¸å…¼å®¹

**ç¦ç”¨ ASAR**ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
```json
{
  "asar": false
}
```

---

### 3. ä¸ºä»€ä¹ˆè¦å¤–éƒ¨åŒ–ä¾èµ–ï¼Ÿ

```javascript
rollupOptions: {
  external: Object.keys(pkg.dependencies)
}
```

**åŸå› **ï¼š
- ä¾èµ–åŒ…å« native æ¨¡å—ï¼ˆå¦‚ `sqlite3`ã€`node-pty`ï¼‰
- ä¿æŒä¸º `require()` è°ƒç”¨ï¼Œè€Œä¸æ˜¯æ‰“åŒ…è¿›ä»£ç 
- electron-builder ä¼šåœ¨æ‰“åŒ…æ—¶é‡æ–°å®‰è£…å’Œç¼–è¯‘

---

### 4. å¦‚ä½•å‡å°å®‰è£…åŒ…ä½“ç§¯ï¼Ÿ

**æ–¹æ³•**ï¼š
1. **ç§»é™¤ä¸å¿…è¦çš„ä¾èµ–**
   ```bash
   npm uninstall unused-package
   ```

2. **ä½¿ç”¨ `devDependencies`**
   ```json
   // å¼€å‘å·¥å…·æ”¾åœ¨ devDependencies
   "devDependencies": {
     "typescript": "^5.8.2",
     "vite": "^6.3.5"
   }
   ```

3. **ç¦ç”¨ source map**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   ```javascript
   build: {
     sourcemap: false
   }
   ```

4. **å¯ç”¨ä»£ç å‹ç¼©**
   ```javascript
   build: {
     minify: "terser"
   }
   ```

---

### 5. å¦‚ä½•é…ç½®è‡ªåŠ¨æ›´æ–°ï¼Ÿ

**æ­¥éª¤ 1**ï¼šé…ç½®å‘å¸ƒåœ°å€

```json
"publish": {
  "provider": "github",
  "owner": "your-username",
  "repo": "behavior3editor"
}
```

**æ­¥éª¤ 2**ï¼šåœ¨ä»£ç ä¸­å¯ç”¨

```typescript
// electron/main/update.ts
import { autoUpdater } from "electron-updater";

autoUpdater.checkForUpdatesAndNotify();
```

**æ­¥éª¤ 3**ï¼šå‘å¸ƒåˆ° GitHub Releases

```bash
npm run build
# ä¸Šä¼  release/ ç›®å½•ä¸­çš„æ–‡ä»¶åˆ° GitHub Releases
```

---

### 6. å¦‚ä½•è°ƒè¯•æ‰“åŒ…é—®é¢˜ï¼Ÿ

**æ–¹æ³• 1**ï¼šæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
DEBUG=electron-builder npm run build
```

**æ–¹æ³• 2**ï¼šæ£€æŸ¥æ‰“åŒ…å†…å®¹
```bash
# è§£å‹ ASAR æ–‡ä»¶æŸ¥çœ‹å†…å®¹
npx asar extract app.asar ./extracted
```

**æ–¹æ³• 3**ï¼šç¦ç”¨ ASAR è°ƒè¯•
```json
{
  "asar": false
}
```

---

## ğŸ“Š å®Œæ•´æ„å»ºæ—¶é—´åˆ†æ

å…¸å‹çš„æ„å»ºæ—¶é—´åˆ†å¸ƒï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ„å»ºæ—¶é—´åˆ†æï¼ˆå‚è€ƒï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  TypeScript ç±»å‹æ£€æŸ¥      ~10-30 ç§’     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                               â”‚
â”‚                                         â”‚
â”‚  Vite ç¼–è¯‘                ~20-60 ç§’     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                       â”‚
â”‚  â”œâ”€ ä¸»è¿›ç¨‹               ~5-10 ç§’      â”‚
â”‚  â”œâ”€ é¢„åŠ è½½è„šæœ¬            ~3-5 ç§’       â”‚
â”‚  â””â”€ æ¸²æŸ“è¿›ç¨‹             ~10-40 ç§’      â”‚
â”‚                                         â”‚
â”‚  electron-builder æ‰“åŒ…    ~30-90 ç§’     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               â”‚
â”‚  â”œâ”€ å®‰è£…ä¾èµ–             ~15-30 ç§’      â”‚
â”‚  â”œâ”€ æ‰“åŒ… ASAR            ~5-10 ç§’       â”‚
â”‚  â””â”€ ç”Ÿæˆå®‰è£…å™¨            ~10-50 ç§’      â”‚
â”‚                                         â”‚
â”‚  æ€»è®¡                     ~60-180 ç§’     â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­æ›´æ–°ï¼‰
npm run dev

# ç±»å‹æ£€æŸ¥
npm run tsc-check

# æ„å»ºï¼ˆå®Œæ•´æµç¨‹ï¼‰
npm run build

# åªæ„å»ºä¸æ‰“åŒ…ï¼ˆè°ƒè¯•ç”¨ï¼‰
npm run preview
```

### æ„å»ºç›®å½•

```
dist-electron/    # Electron ä»£ç 
dist/             # React åº”ç”¨
release/          # æœ€ç»ˆå®‰è£…åŒ…
```

### é…ç½®æ–‡ä»¶

```
package.json           # é¡¹ç›®é…ç½®
electron-builder.json  # æ‰“åŒ…é…ç½®
vite.config.ts         # æ„å»ºé…ç½®
tsconfig.json          # TypeScript é…ç½®
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [electron-builder æ–‡æ¡£](https://www.electron.build/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)
- [vite-plugin-electron](https://github.com/electron-vite/vite-plugin-electron)
- [ASAR æ ¼å¼è¯´æ˜](https://github.com/electron/asar)

ç°åœ¨ä½ åº”è¯¥å®Œå…¨ç†è§£è¿™ä¸ªé¡¹ç›®çš„æ‰“åŒ…æµç¨‹äº†ï¼ğŸ‰

